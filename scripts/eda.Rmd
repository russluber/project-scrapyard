---
title: "Exploratory Data Analysis"
author: "Russel Luber"
date: "2025-11-04"
output: html_document
---

```{r}
library(tidyverse)
library(here)
```

Let's load in the data.

```{r}
d <- read_csv(here("data/fight_data.csv"))
```

## Subsetting the Data

The [Unified Rules of Mixed Martial Arts](https://www.ufc.com/unified-rules-mixed-martial-arts) was adopted November 2000. So let's start from there. Our data will include fights starting from UFC 28: High Stakes.

```{r}
unified_rules_adopted = "2000-11-01"
```


```{r}
d <- d %>%
  filter(date >= as.Date(unified_rules_adopted))
```


Let's exclude fighters who've only fought once or twice.

```{r}
data <- d %>%
  distinct(fighter_id, fight_id, .keep_all = TRUE) %>%
  group_by(fighter_id) %>%
  filter(n_distinct(fight_id) >= 3) %>%
  ungroup()
```


Let's inspect fighters who have only fought once or twice.

```{r}
newbs <- d %>%
  distinct(fighter_id, fight_id, .keep_all = TRUE) %>%
  group_by(fighter_id) %>%
  filter(n_distinct(fight_id) < 3) %>%
  ungroup()
```

There are 1069 rows for newbies (fighter-centric). 


Transform some variables to get striking accuracy measures.

The basic accuracy metric of each fighter, for each fight, will be the ratio between the amount of strikes (punches, kicks, knees, elbows) that hit the opponent and the total number of strikes they threw.

$$\text{striking accuracy} = \frac{\text{strikes landed}}{\text{strikes thrown}}$$
Import caveat: What counts as a strike and how does the UFC count a strike?
- There's a lot of subjectivity to this.
- The way it works it that there's probably a few people at these live events whose job is to count the number of strikes thrown and landed. Then they review the footage afterward and correct their tallies, maybe? Not entirely sure. Need to read up on that.
- What is the difference between a strike and a significant strike? What makes a strike significant? Need to understand that distinction.


```{r}
data <- data %>%
  # Retain striking and striking-relevant variables only + contextual variables
  select(
    -any_of(
      c("tds_landed", "tds_attempted", "tds_stuffed", "subs_attempted", "reversals", "ctrl_time_s",
        "tds_landed_by_opp", "subs_attempted_by_opp", "reversals_by_opp", "ctrl_time_s_for_opp")
      )
  ) %>%
  # Create striking metrics
  mutate(
    # Offensive strike metrics against opponent
    striking_accuracy = if_else(strikes_thrown > 0, strikes_landed / strikes_thrown, 0),
    sig_strikes_accuracy = if_else(sig_strikes_thrown > 0, sig_strikes_landed / sig_strikes_thrown, 0),
    sig_strikes_prop = if_else(sig_strikes_thrown > 0, sig_strikes_thrown / strikes_thrown, 0),
    volume_strikes_accuracy = if_else(volume_strikes_thrown > 0, volume_strikes_landed / volume_strikes_thrown, 0),
    # Defensive strike metrics for fighter
    strikes_avoided_prop = if_else(strikes_thrown_by_opp > 0, strikes_avoided / strikes_thrown_by_opp, 0),
    sig_strikes_avoided_prop = if_else(sig_strikes_thrown_by_opp > 0, sig_strikes_avoided / sig_strikes_thrown_by_opp, 0),
    volume_strikes_avoided_prop = if_else(volume_strikes_thrown_by_opp > 0,
                                          volume_strikes_avoided / volume_strikes_thrown_by_opp, 0),
    # Striking damage metrics against fighter
    strikes_absorbed_prop = if_else(strikes_thrown_by_opp > 0, strikes_landed_by_opp / strikes_thrown_by_opp, 0),
    sig_strikes_absorbed_prop = if_else(sig_strikes_thrown_by_opp > 0, 
                                        sig_strikes_landed_by_opp/ sig_strikes_thrown_by_opp, 0),
    volume_strikes_absorbed_prop = if_else(volume_strikes_thrown_by_opp > 0,
                                           volume_strikes_landed_by_opp / volume_strikes_thrown_by_opp, 0)
  )
```





```{r}
data %>%
  summarise(mean_sig_strike_acc = mean(sig_strikes_accuracy, na.rm = TRUE),
            .by = fighter) %>%
  arrange(desc(mean_sig_strike_acc))
```


Let's look at some simple lots.

```{r}
library(ggplot2)
```


```{r}
# Strikes landed vs. strikes thrown - all fighters across all their fights
ggplot(data, aes(x = strikes_thrown, y = strikes_landed)) +
  geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0, linetype="dashed") +
  coord_equal() +
  labs(
    x = "Strikes Thrown",
    y = "Strikes Landed",
    title = "Strikes Landed vs. Thrown"
  )
```

All fighters, across all their fights, are never 100% accurate with their strikes. They always throw more strikes than they land. Captain Obvious over here, but good to know we can see it in the data.



```{r}
# Significant strikes landed vs strikes thrown
ggplot(data, aes(x = strikes_thrown, y = sig_strikes_landed)) +
  geom_point()
```


```{r}
# Strikes landed vs. strikes thrown by weight class
ggplot(data, aes(x = strikes_thrown, y = sig_strikes_landed)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~ weight_class, ncol = 3)
```

Basic finding: Fighters thrown more than they land (obviously). 


```{r}
ggplot(data, aes(striking_accuracy)) +
  geom_histogram(bins = 30)
```

Need to fix the 0.0 and 1.0 accuracies. 0 fights or 1 fight Andys.


Do fighters tend to land more than their opponent?

```{r}
ggplot(data, aes(x = strikes_thrown, y = strikes_thrown_by_opp)) +
  geom_point()
```


```{r}
ggplot(data, aes(sig_strikes_accuracy)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ method)
```















































































